<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>分布式一致性问题 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="一、Raft1.简介raft是一种分布式一致性算法，是paxos算法更容易理解的版本，如果是paxos是面向理论，那么raft就是面向工程。 raft的工作方式是在集群中选举一个领导者。领导者负责接收客户端请求并进行日志复制到其他服务器。数据只有一个方向流动：从领导者到其他服务器 选举及工作方式模拟器：https:&#x2F;&#x2F;raft.github.io&#x2F; 2. 主要解决的问题 领导者选举  现有领导失效">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式一致性问题">
<meta property="og:url" content="http://example.com/2021/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、Raft1.简介raft是一种分布式一致性算法，是paxos算法更容易理解的版本，如果是paxos是面向理论，那么raft就是面向工程。 raft的工作方式是在集群中选举一个领导者。领导者负责接收客户端请求并进行日志复制到其他服务器。数据只有一个方向流动：从领导者到其他服务器 选举及工作方式模拟器：https:&#x2F;&#x2F;raft.github.io&#x2F; 2. 主要解决的问题 领导者选举  现有领导失效">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-19T16:00:00.000Z">
<meta property="article:modified_time" content="2021-01-20T06:09:09.469Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="框架及中间件">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-分布式一致性问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2021-01-19T16:00:00.000Z" itemprop="datePublished">2021-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      分布式一致性问题
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一、Raft"><a href="#一、Raft" class="headerlink" title="一、Raft"></a>一、Raft</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>raft是一种分布式一致性算法，是paxos算法更容易理解的版本，如果是paxos是面向理论，那么raft就是面向工程。</p>
<p>raft的工作方式是在集群中选举一个领导者。领导者负责接收客户端请求并进行日志复制到其他服务器。数据只有一个方向流动：从领导者到其他服务器</p>
<p>选举及工作方式模拟器：<a target="_blank" rel="noopener" href="https://raft.github.io/">https://raft.github.io/</a></p>
<h2 id="2-主要解决的问题"><a href="#2-主要解决的问题" class="headerlink" title="2. 主要解决的问题"></a>2. 主要解决的问题</h2><ul>
<li>领导者选举<br>  现有领导失效时，需要选举新的领导者</li>
<li>日志复制<br>  领导者需要通过复制保持所有服务器的日志与自己同步</li>
<li>安全性<br>  如果其中一个服务器在特定索引上提交了日志条目，那么其他服务器不能在该索引应用不同的日志条目</li>
</ul>
<p>除了以上三个主要问题还有一些实现上的小问题</p>
<ul>
<li>选举安全  在一次任期内只有一个领导者被选出</li>
<li>leader只添加操作  领导者只添加新条目，不覆盖删除条目</li>
<li>日志匹配  如果两个log包含拥有相同索引和任期的条目，那么两个log从之前到给定索引处的所有日志条目都是相同的</li>
<li>leader完整性  如果在给定的任期中提交了一个日志条目，那么该条目将出现在所有后续更高任期的领导者的日志中</li>
<li>状态机安全性  如果服务器已将给定索引处的日志条目应用于其状态机，则其他服务器不能在该索引位置应用别的日志条目</li>
</ul>
<h2 id="3-领导者选举"><a href="#3-领导者选举" class="headerlink" title="3. 领导者选举"></a>3. 领导者选举</h2><p>服务器存在三种状态：领导者、追随者、候选人</p>
<p><strong>状态变化</strong></p>
<p>在正常操作中，只有一个领导者，其他服务器都是追随者。Raft将时间划分为任意长度的任期每个任期都是以一次选举开始。如果一名候选人赢得选举，他在剩下的任期时间内仍然是领导者。如果投票出现分歧，那么这个任期没有领导者，及时结束。</p>
<p><strong>任期号</strong></p>
<p>任期号单调递增。每个服务器存储当前任期号，并在每次通信中交换该任期编号。</p>
<p>如果一个服务器当前任期号小于其他服务器，那么它将把当前任期更新为更大的值。</p>
<p>如果候选人或领导者发现其任期已过期，则立即转化为追随者状态。</p>
<p>如果服务器收到过期任期号的请求，它将拒绝该请求</p>
<p><strong>通信方式</strong></p>
<p>Raft利用两种rpc来执行其基本操作</p>
<ul>
<li>RequestVote   选举期间</li>
<li>AppendEntry   复制日志条目、心跳</li>
</ul>
<p><strong>详细流程</strong></p>
<p>领导者定期向追随者发送心跳，以维持权限。当追随者在等待领导者的心跳超时时，将触发领导者选举，从追随者转换到候选人状态，并增加其任期号。</p>
<p>在为自己投票后，它会向及其中的其他成员并行发送RequestVote Rpc。这里有三种可能的结果</p>
<ul>
<li>候选人从大多数服务器获得选票并成为领导者。然后，它向集群中的其他成员发送心跳消息以建立权限</li>
<li>如果其他候选人收到AppendEntries Rpc，它们检查任期编号。如果任期大于它们自己，它们接收该服务器为领导者并返回到追随者状态。如果任期号更小，则拒绝该rpc，保持候选人状态</li>
<li>候选人中没有选出领导者。如果同时超过一台服务器成为候选人，由于没有明显的多数票，投票出现分歧。在这种情况下，其中一名候选人超时后，新的选举开始。</li>
</ul>
<blockquote>
<p>Raft通过随机的选举超时时间来确保投票分歧是罕见的，即使出现了它们也能够快速解决。为了从一开始就防止投票分歧，选举超时时间是从固定的间隔中随机选择的(例如，150-300ms)。它被分发到服务器，因此在大多数情况下，只有一台服务器会超时;它赢得了选举，并在其他服务器超时之前发送心跳。同样的机制也用于处理投票分歧。每个候选人在选举开始时重启其随机的选举超时计数，并在开始下一次选举前等待超时;这降低了在新选举中再次出现投票分歧的可能性。</p>
</blockquote>
<h2 id="4-日志复制"><a href="#4-日志复制" class="headerlink" title="4. 日志复制"></a>4. 日志复制</h2><p>当一个领导者收到一个客户端请求时，将它作为一个新的条目添加到自己的日志中，一个条目包含：</p>
<ul>
<li>客户端指定的命令</li>
<li>标识日志中条目位置的索引</li>
<li>任期编号，用于在逻辑上标识条目何时写入</li>
</ul>
<p>领导者并行地向所有其他服务器发出AppendEntries Rpc请求。领导者重复此操作，直到所有追随者安全地复制了新消息</p>
<p>当领导者将条目复制到大多数服务器时，就会认为该条目已提交，然后领导者执行该条目并将结果返回客户端。</p>
<p>领导者维护它已知要提交到日志中的最大索引，每次AppendEntry Rpc会一并将最大索引发送给追随者。一旦追随者发现该条目已提交，追随者也会将该条目按顺序应用到它的状态机</p>
<blockquote>
<p>Raft维护以下属性，它们共同构成日志匹配特征</p>
<p>· </p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98/" data-id="ckk50ch9u000aegmzavllak4a" data-title="分布式一致性问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6%E5%8F%8A%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">框架及中间件</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/01/20/rockermq%E5%AE%95%E6%9C%BA%E5%8F%8A%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          RocketMq宕机及重复消费问题
        
      </div>
    </a>
  
  
    <a href="/2021/01/20/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">响应式编程</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%9F%BA%E7%A1%80/" rel="tag">java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6%E5%8F%8A%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">框架及中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/java%E5%9F%BA%E7%A1%80/" style="font-size: 16.67px;">java基础</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 13.33px;">服务器</a> <a href="/tags/%E6%A1%86%E6%9E%B6%E5%8F%8A%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 20px;">框架及中间件</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/20/Arthas/">Arthas</a>
          </li>
        
          <li>
            <a href="/2021/01/20/COLA/">COLA</a>
          </li>
        
          <li>
            <a href="/2021/01/20/HazelCast%E3%80%81Ignite/">HazelCast、Ignite</a>
          </li>
        
          <li>
            <a href="/2021/01/20/Shiro%E3%80%81Spring%20Security/">Shiro、Spring Security</a>
          </li>
        
          <li>
            <a href="/2021/01/20/cucumber/">cucumber</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>